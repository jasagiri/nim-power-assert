# よくある質問 (FAQ)

このドキュメントでは、PowerAssert for Nim ライブラリに関するよくある質問とその回答を提供します。

## 基本的な質問

### Q: PowerAssert for Nim とは何ですか？
**A:** PowerAssert for Nim は、テスト中のアサーション（表明）が失敗した際に、詳細で視覚的なエラーメッセージを生成するライブラリです。式の各部分の値と型を表示し、テストのデバッグ効率を大幅に向上させます。

### Q: 標準の `assert` や `unittest.check` との違いは何ですか？
**A:** 標準のアサーションと比較して、PowerAssert は以下の利点を提供します：
- 式の各部分の値と型を自動的に抽出して表示
- 式の構造を視覚的に表現
- 複雑な式の中間計算結果も表示
- 手動でデバッグ情報を追加する必要がない
- 副作用を持つ式も安全に処理

### Q: 互換性はどうなっていますか？
**A:** PowerAssert for Nim は、Nim 1.6.0 以降と互換性があります。また、標準の `unittest` モジュールとシームレスに統合できるよう設計されています。

## 使用方法

### Q: ライブラリをインストールするにはどうすればよいですか？
**A:** 以下のコマンドを実行してインストールできます：
```bash
nimble install power_assert
```

### Q: 標準の `unittest` モジュールと一緒に使うにはどうすればよいですか？
**A:** 以下のようにインポートし、PowerAssert の `check` マクロを使用します：
```nim
import unittest except check  # 標準の check を除外
import power_assert           # PowerAssert の check を使用

test "example test":
  let a = 10
  let b = 20
  check(a + b == 30)  # 成功
  check(a * b == 100) # 期待値が異なる場合は詳細な情報を表示
```

### Q: `powerAssert` マクロを直接使用することはできますか？
**A:** はい、`powerAssert` マクロを直接使用することができます：
```nim
import power_assert

let x = 5
let y = 7
powerAssert(x + y == 15)  # 失敗時に詳細なエラーメッセージが表示される
```

### Q: カスタムメッセージを追加することはできますか？
**A:** はい、`powerAssert` マクロは第2引数としてカスタムメッセージを受け取ることができます：
```nim
powerAssert(x == y, "x と y は等しくなければなりません")
```

## 機能と制限

### Q: カスタム型はサポートされていますか？
**A:** はい、ユーザー定義型は自動的にサポートされます。ただし、そのオブジェクトが `$` 演算子（文字列変換）を実装している必要があります：
```nim
type
  Person = object
    name: string
    age: int

proc `$`(p: Person): string =
  p.name & " (age: " & $p.age & ")"

# 使用例
let p1 = Person(name: "Alice", age: 30)
let p2 = Person(name: "Bob", age: 25)
powerAssert(p1 == p2)
```

### Q: どのような型がサポートされていますか？
**A:** PowerAssert は以下を含む様々な型をサポートしています：
- プリミティブ型（整数、浮動小数点数、文字列、ブール値など）
- シーケンスと配列
- テーブル（Table）
- タプル（名前付きタプルを含む）
- オプション型
- その他のユーザー定義型（`$` 演算子を実装している場合）

### Q: 副作用を持つ式を安全に使用できますか？
**A:** はい、PowerAssert は副作用を持つ式を安全に処理するために、式を一度だけ評価します。例えば：
```nim
var counter = 0
powerAssert((counter += 1) == 2)  # counter は一度だけインクリメントされる
```

### Q: リリースビルドでのオーバーヘッドはどうなりますか？
**A:** PowerAssert はリリースビルド（`-d:release` フラグを使用）では詳細なエラーメッセージの生成を無効にし、標準のアサーションと同等のオーバーヘッドに抑えます。

## エラーメッセージ

### Q: エラーメッセージの例を示してください
**A:** 以下は典型的なエラーメッセージの例です：
```
PowerAssert: Assertion failed

a * b == 40

^ 5 (int)
    ^ 7 (int)
      ^ 35 (int)
         ^ 40 (int)
         ^ false (bool)

# Composite expressions:
a * b = 35 (int)
```

### Q: エラーメッセージの色をカスタマイズできますか？
**A:** はい、PowerAssert は出力の色をカスタマイズするための設定オプションを提供しています：
```nim
import power_assert

# 色付き出力を有効化（デフォルトで有効）
enableColors(true)

# カラースキームをカスタマイズ
setColorScheme(
  errorTitle: fgRed,
  varName: fgCyan,
  varValue: fgGreen,
  varType: fgYellow,
  pointer: fgMagenta,
  operator: fgBlue
)
```

## パフォーマンスと最適化

### Q: PowerAssert はテストの実行速度にどのような影響を与えますか？
**A:** PowerAssert は詳細な情報を収集するため、標準のアサーションよりも若干のオーバーヘッドがあります。ただし、アサーションが成功した場合は最小限の影響に抑えられます。また、リリースビルドではオーバーヘッドがさらに削減されます。

### Q: 大きなデータ構造での使用は問題ありませんか？
**A:** 基本的には問題ありませんが、非常に大きなデータ構造（大きな配列やディープネストされたオブジェクトなど）を比較すると、処理時間とメモリ使用量が増加することがあります。将来のバージョンでは大きなデータ構造のより効率的な処理を予定しています。

### Q: コンパイル時間への影響はありますか？
**A:** PowerAssert はマクロを使用するため、標準のアサーションと比較してコンパイル時間がわずかに増加する可能性があります。ただし、通常の使用では顕著な違いはないはずです。

## トラブルシューティング

### Q: マクロ展開エラーが発生する場合はどうすればよいですか？
**A:** 複雑な式や特殊な構文を使用している場合、マクロ展開エラーが発生することがあります。このような場合は、式を単純化するか、一時変数に分解してみてください。問題が解決しない場合は、GitHub の Issue として報告してください。

### Q: カラー出力が表示されない場合はどうすればよいですか？
**A:** 一部の環境ではカラー出力がサポートされていないか、正しく表示されないことがあります。この場合は、`enableColors(false)` を使用して色付き出力を無効にしてください。

### Q: テスト実行時に「アドレス空間が足りません」というエラーが発生する場合は？
**A:** 非常に複雑で大きな式を使用すると、マクロ展開時にメモリ使用量が増加することがあります。式を単純化するか、複数の小さなアサーションに分割してみてください。

## 拡張と貢献

### Q: バグを報告したり機能リクエストを提出するにはどうすればよいですか？
**A:** GitHub リポジトリの Issue セクションでバグ報告や機能リクエストを提出できます。可能な限り再現手順や具体的な使用例を含めてください。

### Q: プロジェクトに貢献するにはどうすればよいですか？
**A:** プロジェクトへの貢献を歓迎します。コントリビュータガイドラインに従って、プルリクエストを提出してください。まず Issue を作成して変更について議論することをお勧めします。

### Q: ライセンスはどうなっていますか？
**A:** PowerAssert for Nim は MIT ライセンスの下で公開されています。詳細はプロジェクトのライセンスファイルを参照してください。

## 将来の計画

### Q: 今後のリリース予定は？
**A:** 今後のリリース予定および計画されている機能については、プロジェクトの `TODO.md` ファイルを参照してください。主な計画には以下が含まれます：
- パフォーマンスの最適化
- より多くの型のサポート
- 出力フォーマットの追加オプション
- IDE プラグインとの統合
- ビルドツールとの統合の改善

### Q: 特定の機能リクエストを提案することはできますか？
**A:** はい、GitHub の Issue トラッカーで機能リクエストを提案できます。実現可能性とプロジェクトの方向性に基づいて検討されます。